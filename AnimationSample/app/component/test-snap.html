<!DOCTYPE html>
 <html>
     <style>
       #div{
           width: 850px;
           height:850px;
           border-color: black;
           border:1px solid #c3c3c3;
           justify-content: center;
           align-items: center
       }
       #svg{
           width: 850px;
           height: 850px;
           background-color:bisque
       }
     </style>
     <head>
            <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
            <meta name="viewport" content="initial-scale=3.0,minimum-scale=1.0,maximum-scale=64,user-scalable=1">
     </head>
     <body>
         <div id="div">
                <button onclick="onClick()">点击取消动画</button>
                <?xml version="1.0" ?><!DOCTYPE svg  PUBLIC '-//W3C//DTD SVG 20010904//EN'  'http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd'>
                <svg id="svg" height="850.000000pt"  preserveAspectRatio="xMidYMid meet" version="1.0" viewBox="0 0 850.000000 850.000000" width="850.000000pt" xmlns="http://www.w3.org/2000/svg">
                <metadata>
                Created by potrace 1.14, written by Peter Selinger 2001-2017
                </metadata>
                <g fill="#ffffff" stroke="#f00" transform="translate(0.000000,850.000000) scale(0.100000,-0.100000)">
            <path d="M5903 4810 c-91 -18 -156 -71 -182 -149 -17 -53 -13 -189 11 -339 31 -196 31 -426 0 -537 -43 -149 -126 -271 -247 -362 -102 -77 -178 -105 -298 -111 -122 -5 -209 19 -283 79 -62 52 -80 61 -104 54 -19 -6 -19 -8 9 -48 65 -95 137 -266 167 -396 13 -56 21 -187 12 -196 -2 -2 -47 12 -100 30 -131 46 -239 65 -368 65 -80 0 -121 5 -163 19 -69 24 -292 130 -357 170 l-48 29 -60 -36 c-136 -82 -277 -221 -378 -374 -25 -37 -90 -152 -144 -255 -73 -139 -108 -219 -135 -308 -162 -534 -311 -902 -488 -1205 -30 -52 -54 -96 -52 -98 1 -2 43 -11 93 -22 49 -10 99 -23 111 -30 18 -9 26 -9 39 2 9 7 93 76 187 154 372 307 557 436 790 550 333 162 568 210 992 202 217 -5 247 -7 337 -31 192 -51 348 -148 506 -313 47 -49 112 -129 144 -179 246 -377 227 -355 309 -355 45 0 177 29 177 38 0 4 -11 61 -25 127 -71 345 -100 678 -92 1047 6 264 7 274 67 668 11 74 22 208 25 298 5 179 25 262 80 343 64 91 206 156 350 160 28 1 64 4 80 8 l30 6 -56 32 c-53 30 -109 83 -109 104 0 20 40 7 96 -31 83 -57 174 -83 272 -79 108 5 174 39 278 143 151 151 208 335 137 443 -9 14 -58 56 -109 94 -106 80 -152 128 -314 329 -64 80 -139 169 -167 199 l-50 55 -29 -21 c-77 -55 -220 -83 -421 -83 -127 0 -425 23 -462 36 -11 3 -8 11 12 32 48 50 30 61 -70 42z m349 -411 c52 -26 116 -28 185 -5 93 31 134 3 75 -52 -41 -38 -99 -54 -195 -52 -45 1 -108 -4 -139 -11 -66 -15 -84 -6 -48 23 l25 20 -56 -7 c-55 -7 -99 4 -99 25 0 5 27 17 60 26 33 9 60 21 60 25 0 5 9 18 20 29 22 22 32 20 112 -21z m1080 -261 c12 -17 23 -52 26 -77 8 -92 -59 -93 -105 -1 -28 54 -29 74 -4 99 25 25 55 17 83 -21z m-3602 -2489 c-61 -54 -180 -100 -180 -70 0 15 76 70 117 86 21 7 52 14 68 14 l30 0 -35 -30z m80 -29 c0 -17 -40 -51 -83 -69 -23 -10 -62 -35 -86 -55 -65 -54 -119 -62 -92 -13 11 20 103 88 176 129 33 19 85 24 85 8z" id="28"/>
            <!-- <rect x='5000' y='2000' width='5000' height='5000' mask='url(#Mask)' fill='white'></rect> -->
           
            </g>
        
            </svg>
            <!-- <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                <defs>
                  <linearGradient id="Gradient">
                    <stop offset="0" stop-color="white" stop-opacity="0" />
                    <stop offset="1" stop-color="white" stop-opacity="1" />
                  </linearGradient>
                  <mask id="Mask">
                    <circle  cx="50" cy="50" fill="white" r='50' fill-opacity='0.1'/>
                  </mask>
                </defs>
              
                <rect x="0" y="0" width="200" height="200" fill="red" />
                
                <rect x="0" y="0" width="200" height="200" fill="green" mask="url(#Mask)">
                    <rect x="0" y="0" width="200" height="200" fill="white"  />
                </rect>
               
              </svg> -->
        </div>
        
          <script src="./snap.svg.js"></script>
          <script src="./hammer.js"></script>
          <script src="./svg-injector.min.js"></script>
          <script src="./anime.js"></script>
          <script>
           var svg;
           var animation;
          var click_animation=false
           var d = 'M440.7,717.2c24.8-3,46.7,13.6,69.1,21.4c22,7.7,45.8,11.1,69,8.1c39.7-5,74.9-30.3,91.3-67.1c9.3-20.9,9.6-42.4,8.8-64.9c-0.8-22.7-1.2-50,15.5-67.8c10.7-11.4,26.9-14.7,40.6-21.2c9.9-4.7,19.3-10.3,28-17c21.9-17,37.2-40.8,41.6-68.4c2.9-18.4,1.3-37.6-3.4-55.6c-5.8-22.3-17.2-42.8-29-62.4c-12.2-20.1-27.4-39.7-34.7-62.2c-6.2-19.1-6.2-39.3-9.6-59c-3.6-20.9-11.4-41-24.5-57.9c-12.6-16.2-29-29-46.7-39.1C637,92.8,615,83.5,592,82.7c-22.1-0.8-43.3,7-63.7,14.7c-21.4,8-43.3,16.4-66.5,16c-23.1-0.4-45.2-8.5-66.1-17.5c-20.2-8.7-40-18.7-61-25.5c-20.2-6.5-41.4-9.2-62.6-7.3c-42,3.8-81.3,24.6-108.6,56.6c-27.6,32.3-43.4,74.5-45.1,116.8c-1,25.5,4.6,51.2,0.5,76.5c-3.6,22.2-16,40.6-29.2,58.3c-12.1,16.3-24.8,32.6-31.6,52c-6.1,17.4-7.8,36.2-5.8,54.5c2,17.8,7.4,35.3,16.4,50.9c9,15.6,21.2,27.5,35.9,37.7c8.2,5.7,16.9,11.5,22.6,20c7.5,11.2,5.6,24,5.5,36.7c-0.1,21.6,4.7,43.3,13.8,62.9c9.1,19.6,23,36.7,38.7,51.4c15,14.1,32.4,25.7,51.3,33.7c38.7,16.3,81.1,14.3,120-0.6c13.1-5,25.5-11.9,36.5-20.6c8.4-6.6,15.8-14.2,23.9-21C423.9,723.2,431.5,718.6,440.7,717.2'
           var d2 =`M0 -43.3 50 43.3 -50 43.3Z`
           window.onload=function(){
                // SVGInjector(document.querySelector('img#svg'), {}, inite);  <!-- <circle cx="6150" cy="4620" r="500" fill="#ffff00" ></circle> -->
           }
           inite()
           function inite(){
            svg=Snap('#svg')
            // var group = document.querySelector('svg#svg g');
            // var path = svg.path(d)
            
            // path.attr({fill:'#fff',stroke:'#000',scale:10})
            var bbox=document.getElementById('svg').getBBox();
            document.getElementById('svg').addEventListener('mousedown',this.touchdown.bind(this))
            var g2 = svg.paper.gradient('l(0, 0, 1, 1)#000-#f00-#fff');
               var circles= svg.paper.circle(200, 200, 40).attr({
                    fill: g2
                });
                // circles.animate({r: (80)}, 500, mina.easeout(), function() {
                //     console.log('animation end');
                //     // circles.remove()
                // });
           }



           function onClick(e){
               console.log('onclick==')
               if(animation){
                animation.complete()
               }
           }
           function touchdown(e){
                
                console.log(click_animation+'------')
                if(click_animation){
                   return
                }
                // var target = e.targetTouches[0];
                var touch= e; 
                var _x=touch.clientX //鼠标在画布上的x坐标，以画布左上角为起点 
                var _y=touch.clientY//鼠标在画布上的y坐标，以画布左上角为起点 
                var path = Snap.getElementByPoint(_x, _y);
                var g2 = svg.paper.gradient('l(0, 0, 1, 1)#000-#f00-#fff');
                path.attr({
                    fill: g2
                });
                // var group = document.querySelector('svg#svg g');
                // var group2= svg.select('g');
                var group3=path.parent()
                var bBox=path.getBBox()
               var trans=group3.attr('transform')
               var Matrax=trans.totalMatrix;
            //    var Matrax2={
            //        a:-Matrax.a,
            //        b:-Matrax.b,
            //        c:-Matrax.c,
            //        d:-Matrax.d,
            //        e:-Matrax.e,
            //        f:-Matrax.f,
            //    }
                if(path.type=='path'){
                   // 第一版
                //     var path1 = svg.paper.path(path.attr('d'))
                    
                //    var width= document.getElementById(path1.id)
                //   var circles=  group3.circle({
                //     cx: (_x/(600/850)-Matrax.e)/Matrax.a,
                //     cy: (_y/(600/850)-Matrax.f)/Matrax.d,
                //     r: 50,
                //     fill: '#ff0',
                //     'clip-path':path1,
                //     fillOpacity: 0.1,
                //     // transform:Matrax2
                //     });
                //     // group.dataset.push(circle)
                //     // var distance=Math.sqrt(bBox.width*bBox.width+bBox.height*bBox.height)
                //     var distance=Math.max(bBox.width,bBox.height)
                //     path.attr({
                //       'clip-path':circles
                //     })
                //     console.log('path=====')
                //     circles.animate({r: (distance)}, 1000, mina.easeout(), function() {
                //     console.log('animation end');
                //     circles.remove()
                //     // path.attr({
                //     // fill: g2,
                //     // 'clip-path':null
                //     // });
                // });
                // 第二版
                //      var path1 = group3.path(path.attr('d'))
                //      path1.attr({
                //          fill:'#fff'
                //      })
                //      path.insertAfter(path1)
                //    var width= document.getElementById(path1.id)
                //    var circles=  group3.circle({
                //     cx: (_x-Matrax.e)/Matrax.a,
                //     cy: (_y-Matrax.f)/Matrax.d,
                //     r: 50,
                //     fillOpacity: 0,
                //     });
                //     path.attr({
                //       'clip-path':circles
                //     })
                //     var distance=Math.max(bBox.width,bBox.height)
                   
                //     circles.animate({r: (distance)}, 1000, mina.easeout(), function() {
                    
                //     var clip= svg.select('clipPath')
                //     clip.remove()
                //     path1.remove()
                //     circles.remove()
                    
                // });
                //第三版
                 var path1 = group3.path(d)
               
                 var bBox2=path1.getBBox()
                 var distance=Math.sqrt(bBox.width*bBox.width+bBox.height*bBox.height)
                 var distance2=Math.sqrt(bBox2.width*bBox2.width+bBox2.height*bBox2.height)
                var mx=(_x-Matrax.e)/Matrax.a-bBox2.cx;
                var my =(_y-Matrax.f)/Matrax.d-bBox2.cy

                     path1.attr({
                         fill:'#fff',
                        //  transform:myMatrix,
                         fillOpacity: 0,
                         class:'clip'
                     })
                    path.attr({
                      'clip-path':path1
                    })
                    var el= document.getElementsByClassName('clip')
        
                    
                    el[0].style.transformOrigin='center';
                    anime({
                      targets:'.clip',
                      translateX:mx,
                      translateY:my,
                      duration:0
                    })
                    animation= anime({
                      targets:'.clip',
                      scale:(Math.max(bBox.width/bBox2.width,bBox.height/bBox2.height)+0.5)*2 ,
                      duration:5000,
                      easing: 'linear',
                      rotate:'0.2turn',
                      begin:function(anim){
                        click_animation=true
                      },
                      complete: function(anim) {
                        finish()
                      }
                    })
                    // animation= anime.timeline({
                      
                    // })
                    // .add({
                    //   targets:'.clip',
                    //   translateX:mx,
                    //   translateY:my,
                    //   duration:0
                    // })
                    // .add({
                    //   targets:'.clip',
                    //   scale:(Math.max(bBox.width/bBox2.width,bBox.height/bBox2.height)+0.5)*2 ,
                    //   duration:5000,
                    //   easing: 'linear',
                    //   rotate:'0.2turn',
                    //   begin:function(anim){

                    //   },
                    //   complete: function(anim) {
                    //     finish()
                    //   }
                    // })
                   
              //       console.log('path====='+distance+'---'+distance2+'---'+distance/distance2)

                }
               function finish(){
                 var clipPath=svg.select('clipPath');
                 click_animation=false
                 if(clipPath){
                  clipPath.remove()
                 }
                console.log('finish')
               }
                
               
           }


            
          </script>
     </body>
 </html>